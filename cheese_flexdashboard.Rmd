---
title: "The Cheese Project (ERHS535 F25)"
output:
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    navbar:
      - title: "Github Repo"
        href: "https://github.com/alinagalyon/Cheese-database"
        target: "_blank"
        align: left
theme:
  version: 4
  bootswatch: minty
css: styles.css
runtime: shiny
---


# Home

```{r}
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))

## Install/load packages required
load_or_install <- function(pkg) {
  if (!requireNamespace(pkg, quietly = TRUE)) {
    install.packages(pkg, dependencies = TRUE, repos = "https://cloud.r-project.org")
  }
  library(pkg, character.only = TRUE)
}

pkgs <- c("dplyr", 
          "tidyr", 
          "DT", 
          "shiny", 
          "flexdashboard",
          "tidyverse",
          "stringr",
          "tidyr",
          "ape",
          "rotl",
          "ComplexHeatmap",
          "circlize",
          "tibble",
          "tidyverse",
          "readr",
          "leaflet",
          "leaflet.extras",
          "sf",
          "knitr",
          "rnaturalearth",
          "tigris",
          "ggthemes",
          "cartogram",
          "scales",
          "viridis",
          "htmltools",
          "ggplot2",
          "ggimage",
          "plotly",
          "scales",
          "grid",
          "tidyverse",
          "dplyr")

invisible(lapply(pkgs, load_or_install))


```


```{r}
library(flexdashboard)
library(shiny)
palette(c("#CEAB44", "#FEBD37", "#DABB9F", "#4E501A", "#ABC115", "#CC160E", "#F75400", "#59454C", "#F2F3EF", "#0A0E15"))
```

## Column

### The Cheese Project


Wow, do you love cheese? 

Yes? 

That means you're in the right place. Don't forget the crackers!

##### Cheese Data Information and Location: 
We are using the **cheese data** from [tidytuesday cheese data](https://github.com/rfordatascience/tidytuesday/tree/main/data/2024/2024-06-04) 
The tidytuesday cheese data is located in the folder from data/2024 on 06-04-2024 which is linked above.
The *cheese information* comes from [cheese.com](https://www.cheese.com/) which uses cheese characteristics to help consumers locate their ideal cheese and relevant vendors. 

The cheese data lists a different cheese type in each row (under the "cheese" column) and includes the cheese.com website for this cheese, the milk used to make the cheese, the cheese production region and cheese characteristics such as fat and calcium content as well as flavor, color, aroma, rind and cheese family grouping characterization. There is different information included for different cheese types and so there are many "NA" values included.For a complete breakdown of the column names and tidydata data frame see the [tidytuesday cheese ReadMe](https://github.com/rfordatascience/tidytuesday/blob/main/data/2024/2024-06-04/readme.md) 

##### Cheese Dashboard Uses: 
In our cheese dashboard, we are showing:

1. cheese production region in an interactive map 
2. cheese flavor families in a heatmap of flavor and milk (animal-produced)
3. number of cheese types by producing animal
4. cheeses to try by characteristic (check out the drop down box!)

Navigate to different tabs to check out our cheese info and data graphics!


Group Members: Gianna Zinnen, Alina Galyon, Danielle Samson, Christopher Tsz Hin Choi


<img src="https://c.tenor.com/hN89U2X0PC4AAAAC/tenor.gif" width="400" height="300"/>


# Cheeses Around the World

### Cheese around the world description {data-height="500"}

This map showcases cheese production across the globe, with color gradients indicating the number of cheese varieties produced in each country. Hover over a country to discover fast facts about the types of cheese made there!


### Chart 1 {data-height="2000"}

```{r, include=FALSE}
source("cheese_around_the_world.R")
```

```{r}
cheese_map
```


# Cheese Phylogeny


### Cheese Phylogeny {data-height="500"}

A flavor-by-animal heatmap ordered by an OpenTree phylogeny. A phylogenetic tree of the primary milk sources (i.e., cow, goat, sheep, etc) was constructed using the ape and rotl packages. The individual cheese flavor notes from the milks of each animal was grouped into 7 broad flavor groups, and the phylogenetic tree of each animal was mapped to a heatmap of flavors with extra row annotations (avg fat, avg calcium) and tree tip labels, showing sample size: "cow (n=771)". 

<!-- ## Column 2 {data-height="2000"} -->

### Chart {data-height="2000"}
```{r, include=FALSE}
source("cheese_heatmap.R")
```

```{r, fig.width = 11, fig.height = 4}
h
```



# Where does cheese come from?

## Column 1 {data-height="800"}

### Amount of cheeses made with different animal milk: {data-height="800"}

Bar graph showing the number of cheeses produced by type of animal. Log base 10 is used to show the counts along the displayed x-axis. Moose, donkey and camel all have a count of 1 cheese type. All animal icons are from BioRender. Numbers at end of bar indicate total count of cheese type.

## Column 2 {data-height="2000"}

```{r, include=FALSE}
source("cheese_count_animal.R")
```

```{r}
Animal_Cheese
```




# Discover A New Cheese


```{r}
cheeses_finder = cheeses |>
  dplyr::mutate(
    milk = tidyr::replace_na(milk, "Not-Reported"),
    rind = tidyr::replace_na(rind, "Not-Reported")#,
    # region = tidyr::replace_na(region, "Not-Reported"),
    # type = tidyr::replace_na(type, "Not-Reported"),
    # fat_content = tidyr::replace_na(fat_content, "Not-Reported")
    
  ) |>
  dplyr::select(-`...1`)
```

## Inputs {.sidebar data-width=250}
```{r}
selectInput(
  "selected_country",
  "Country",
  choices = sort(unique(cheeses_finder$country))
)

# selectInput(
#   "selected_region",
#   "Region",
#   choices = NULL
# )

selectInput(
  "selected_milk",
  "Milk",
  choices = NULL
)

selectInput(
  "selected_rind",
  "Rind",
  choices = NULL
)

# selectInput(
#   "selected_type",
#   "Type",
#   choices = NULL
# )


```

```{r}
# Update milk choices after country selection
observeEvent(input$selected_country, {
  
  available_milk <- cheeses_finder |>
    dplyr::filter(country == input$selected_country) |>
    dplyr::pull(milk) |>
    unique() |>
    sort()
  
  updateSelectInput(
    session,
    "selected_milk",
    choices = available_milk,
    selected = available_milk[1]
  )
})

# Update rind choices after country OR milk selection
observeEvent(
  c(input$selected_country, input$selected_milk),
  {
    available_rind <- cheeses_finder |>
      dplyr::filter(
        country == input$selected_country,
        milk == input$selected_milk
      ) |>
      dplyr::pull(rind) |>
      unique() |>
      sort()
    
    updateSelectInput(
      session,
      "selected_rind",
      choices = available_rind,
      selected = available_rind[1]
    )
  }
)

```

```{r}
## Registers what the columns record
filtered_cheeses <- reactive({
  req(
    input$selected_country,
    input$selected_milk,
    input$selected_rind
)
  cheeses_finder |>
    dplyr::filter(
      country == input$selected_country,
      milk == input$selected_milk,
      rind == input$selected_rind
      ) #|>
    # # rename columns so that they look nicer
    # dplyr::rename_with(~ stringr::str_to_title(.x)) |>
    # dplyr::rename(`Fat Content` = Fat_content,
    #               `Calcium Content` = Calcium_content,
    #               `Alternative Spellings` = Alt_spellings)
})
```

Discover a new cheese by selecting from drop-down options above.

Click on the cheese names to find out more about them!




Column
-----------------------------------------------------------------------

### Cheeses to try


```{r}
## List of cheeses that fit the filter conditions (clickable)
output$cheese_table <- DT::renderDT({
  df <- filtered_cheeses() |>
    dplyr::select(cheese)
  DT::datatable(
    df,
    selection = "single",
    rownames = FALSE,
    options = list(dom = "t")
    )
})

DT::DTOutput("cheese_table")


```


Column
-----------------------------------------------------------------------

```{r}
## Tabel output with working URL
output$cheese_details <- renderTable({
  req(input$cheese_table_rows_selected)

  row <- filtered_cheeses()[input$cheese_table_rows_selected, ]

  details <- data.frame(
    Field = names(row),
    Value = as.character(t(row)),
    stringsAsFactors = FALSE
  )

  # Turn URL into clickable link that opens in new tab
  details$Value[details$Field == "url"] <-
    sprintf(
      '<a href="%s" target="_blank">%s</a>',
      details$Value[details$Field == "url"],
      details$Value[details$Field == "url"]
    )

  details
}, sanitize.text.function = identity)

tableOutput("cheese_details")


# ## Simple output
# output$cheese_details <- renderTable({
#   req(input$cheese_table_rows_selected)
#   row <- filtered_cheeses()[input$cheese_table_rows_selected, ]
# 
#   data.frame(
#     Field = names(row),
#     Value = as.character(t(row)),
#     stringsAsFactors = FALSE
#     )
#   })
# 
# 
# tableOutput("cheese_details")

```


<div class="flexdashboard-footer">
  <img src="https://i.pinimg.com/originals/53/c6/3e/53c63e16bea013e34932ea38d61cf843.gif"
       alt="Running mouse"
       style="height:400px;">
</div>

<!-- <div class="flexdashboard-footer"> -->
<!--   <img src="https://i.pinimg.com/originals/53/c6/3e/53c63e16bea013e34932ea38d61cf843.gif" -->
<!--        alt="Running mouse"> -->
<!-- </div> -->


